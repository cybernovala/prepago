<!-- SOLO SE MUESTRA LO NUEVO EN EL SCRIPT -->
<script>
  async function consultarRut() {
    const rut = document.getElementById('rutInput').value.trim();
    const resultadoDiv = document.getElementById('resultado');
    const errorDiv = document.getElementById('error');
    resultadoDiv.classList.add('d-none');
    errorDiv.classList.add('d-none');

    if (!rut) {
      errorDiv.textContent = "Ingresa un RUT";
      errorDiv.classList.remove('d-none');
      return;
    }

    try {
      const res = await fetch('https://prepago.onrender.com/consultar', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ rut })
      });
      const data = await res.json();
      if (res.ok) {
        rutGlobal = rut;
        localStorage.setItem('rut', rut);
        document.getElementById('nombre').textContent = data.nombre;
        document.getElementById('saldo').textContent = data.saldo;
        document.getElementById('btnWhatsapp').onclick = () => {
          const mensaje = `Hola, soy ${data.nombre} (RUT: ${rutGlobal}). Solicito una impresión.`;
          window.open(`https://wa.me/56966648585?text=${encodeURIComponent(mensaje)}`, '_blank');
        };

        const historialHtml = data.historial.map(entry =>
          `<li>${entry.tipo.toUpperCase()}: ${entry.cantidad} páginas - ${new Date(entry.fecha).toLocaleString()}</li>`
        ).join('');
        document.getElementById('historial').innerHTML = `<ul>${historialHtml}</ul>`;

        resultadoDiv.classList.remove('d-none');
      } else {
        errorDiv.textContent = data.error || "Error al consultar";
        errorDiv.classList.remove('d-none');
      }
    } catch {
      errorDiv.textContent = "No se pudo conectar al servidor.";
      errorDiv.classList.remove('d-none');
    }
  }
</script>

<!-- AGREGAR DENTRO DE RESULTADO -->
<div id="historial" class="mt-3"></div>
